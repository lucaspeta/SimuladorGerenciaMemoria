@model SimuladorGerenciaMemoria.Models.Memory

@{
    ViewData["Title"] = "Detalhes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/loading.css" />

<h1>Detalhes da memória</h1>

<div>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.SimulationID)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Simulation.Name)
        </dd>

        <dt class="col-sm-2">
            Memória
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Name)
        </dd>

        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Size)
        </dt>
        <dd class="col-sm-10">            
            @Html.DisplayFor(model => model.Size) bytes
        </dd>

        <dt class="col-sm-2">
            Quantidade de frames
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.FramesQTD)
        </dd>

        <dt class="col-sm-2">
            Tamanho dos frames
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.FramesSize) bytes
        </dd>

        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.InitialState)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.InitialState)
        </dd>

        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.IsGeneratedProcessList)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.IsGeneratedProcessList)
        </dd>

        <dt class="col-sm-2">
            Data de Criação
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CreateDate)
        </dd>
    </dl>
</div>
<div>
    <a class="btn btn-info" asp-action="GerarProcessos" asp-route-id="@Model.ID">Gerar Processos</a> |
    <a data-toggle="modal" data-target="#algModal" data-alg="QuickFit" class="btn btn-success btn-alg">Quick-fit</a> |
    <a data-toggle="modal" data-target="#algModal" data-alg="FirstFit" class="btn btn-success btn-alg">First-fit</a> |
    <a data-toggle="modal" data-target="#algModal" data-alg="BestFit" class="btn btn-success btn-alg">Best-fit</a> |
    <a data-toggle="modal" data-target="#algModal" data-alg="WorstFit" class="btn btn-success btn-alg">Worst-fit</a> |
    <a class="btn btn-info" asp-action="Edit" asp-route-id="@Model.ID">Editar</a> |
    <a class="btn btn-info" asp-action="Index">Voltar para a lista</a>
</div>

<br />

<div id="carregando" class="overlay">
    <p style="font-weight: 800;">Carregando</p>
    <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<div class="panel">
    <div class="panel-heading">
        <h3>Lista de processos inicial na memória</h3>
    </div>
    <div class="panel-body">
        <div class="table">
            <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-dark" id="tableDados">
                <thead>
                    <tr>
                        <th>
                            Nome
                        </th>
                        <th>
                            Registrador Base
                        </th>
                        <th>
                            Registrador Limite
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        foreach (var item in Model.Frames)
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Name)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RegB)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.RegL)
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="algModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalAlgTitle"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="modal-body-text"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="iniciar-simulacao btn btn-success">Iniciar</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="~/css/datatables.min.css" />
<script src="~/js/datatables.min.js"></script>

<script>
    $('.btn-alg').on('click', function (){
        var algoritmo = $(this).data('alg');
        var memoriaID = '@(ViewBag.memoriaID)';
        var processQTD = '@(ViewBag.processQTD)';

        $('#modalAlgTitle').text('Inicializar a simulação (' + algoritmo + ')');
        $('#modal-body-text').text('Quantidade processos a serem inseridos na memória (' + processQTD + ')');

        $('.iniciar-simulacao').data('alg', algoritmo);
    });

    $('.iniciar-simulacao').on('click', function () {
        var algoritmo = $(this).data('alg');
        var memoriaID = '@(ViewBag.memoriaID)';

        var dataToController = { id: memoriaID };

        console.log('memoriaID ' + JSON.stringify(dataToController));

        $.ajax({
            type: "POST",
            url: "/Memories/" + algoritmo + "Insertion/",
            data: JSON.stringify(dataToController),
            datatype: "text",
            success: function (msg) {
                console.log(msg);
            },
            error: function (req, status, error) {
                console.log(msg);
            },
            done: function (){
            }
        });
    });

    $('#algModal').on('hidden.bs.modal', function (e) {
        $('#modalAlgTitle').text();
        $('#modal-body-text').text();
    });

    $('#tableDados').dataTable({
        responsive: true,       
        "order": [[1, "asc"]],
        "oLanguage": {
            "sProcessing": "Processando...",
            "sLengthMenu": "Mostrar _MENU_ registros",
            "sZeroRecords": "Não foram encontrados resultados",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando de 0 até 0 de 0 registros",
            "sInfoFiltered": "",
            "sInfoPostFix": "",
            "sSearch": "Buscar : ",
            "sUrl": "",
            "oPaginate": {
                "sFirst": "Primeiro",
                "sPrevious": "Anterior",
                "sNext": "Seguinte",
                "sLast": "Último"
            }
        }
    });
</script>